### 스케일링

- IT 자원을 확장하거나 축소하는 기능
- 자원의 사용 요구는 상황이나 이벤트에 따라서 가변적이므로 필수 기능이다.

#### 스케일링의 종류

- 스케일링 종류의 구분 기준은 확장 및 축소의 방향
- **수직 스케일링**
    - IT 자원의 **용량**을 확장하거나 축소하는 것
    - **스케일 업**: 자원을 성능이 좋은 사양으로 대체하는 것
    - **스케일 다운**: 성능이 낮은 것으로 대체하는 것
    - 즉, 부하에 따라서 IT 자원의 자체 성능을 조정한다.
- **수평 수케일링**
    - IT 자원의 **수량**을 확장하거나 축소하는 것
    - **스케일 인**: 수량을 늘리는 것
    - **스케일 아웃**: 수량을 줄이는 것
    - 즉, 부하에 따라서 IT 자원의 수량을 조정한다.

### AWS 오토 스케일링 서비스

- AWS 제공하는 동적 스케일링 서비스
- 클라우드이기 때문에 가능한 **온디맨드 특성(요구가 있을 때 즉시 반영)**

#### Amazon EC2 오토 스케일링

- EC2 내에 설치된 애플리케이션 워크로드를 수용하도록 동적으로 워크로드를 유지
- 즉, **수평 스케일링 (스케일 인, 아웃)**

#### AWS EC2 오토 스케일링 구성 요소

- **그룹**
    - EC2를 논리적으로 구분하는 그룹
    - 그룹 생성시 EC2의 최소/최대 인스턴스 수와 최소 요구하는 인스턴스 수 지정 가능
- **구성 템플릿**
    - EC2 인스턴스를 구성하는 템플릿
    - AMI, 인스턴스 유형, 키페어, 보안 그룹 정보 지정
- **조정 옵션**
    - 그룹 조정하는 방법을 정의

#### Amazon EC2 오토 스케일링의 인스턴스 수명 주기

- 오토 스케일링은 일반 EC2 인스턴스와는 달리 수명 주기가 있다.
- 수명 주기의 시작은 EC2 오토 스케일링이 인스턴스를 시작하고 서비스에 들어갈 때 시작된다.
- 인스턴스를 종료할 때는 서비스에서 제외하고 대상을 종료한다.

**인스턴스 확장에 따른 이벤트**

1. 오토 스케일링 그룹의 크기를 수동으로 늘리는 경우
2. 지정된 수요 증가에 따라 오토 스케일링 그룹의 크기를 자동으로 늘리는 조정 정책을 적용하는 경우
3. 특정 시간에 오토 스케일링 그룹의 크기를 자동으로 늘리는 예약된 작업을 수행하는 경우

> 어찌됐던 인스턴스 확장 이벤트가 발생하면
> 1. 오토 스케일링은 구성 템플릿을 들여다 보고 필요한 수의 인스턴스를 시작한다. 이때 인스턴스 상태는 '대기 중'
> 2. 인스턴스가 구성이 완료되면 오토 스케일링에 연결되어 '실행 중' 상태로 변경된다.
> 3. 여기에서 오토 스케일링이 로드 밸런서와 연결되면 로드 밸런서가 인스턴스를 자동으로 등록하는 작업이 진행되고 '실행 중' 상태로 변경된다.

**인스턴스 축소에 따른 이벤트**

1. 오토 스케일링 그룹의 크기를 수동으로 줄이는 경우
2. 지정된 수요 감소에 따라 오토 스케일링 그룹의 크기를 자동으로 줄이는 조정 정책을 적용하는 경우
3. 특정 시간에 오토 스케일링 그룹의 크기를 자동으로 줄이는 예약된 작업을 수행하는 경우

> 축소 이벤트 발생시
> 1. 오토 스케일링은 하나 이상의 인스턴스를 종료한다. 이때 종료 정책으로 종료 인스턴스를 결정한다.
> 2. 선택된 인스턴스의 상태가 '종료 중'으로 변경된다.
> 3. 인스턴스가 완전히 종료되면 '종료 됨' 상태가 되고, 오토 스케일링에서 삭제된다.

**드레이닝:** 삭제 인스턴스가 바로 삭제 안되고, 일정 대기 시간이 지난 후 삭제되는 상태

#### Amazon EC2 오토 스케일링 조정 옵션

**인스턴스를 일정한 수로 유지**

- 조정 옵션을 통해서 오토 스케일링 그룹의 인스턴스 수를 지정된 수로 유지 가능

**수동 조정**

- 가장 기본적인 방법
- 오토 스케일링 그룹의 최대/최소 용량을 수동으로 변경

**동적 조정**

- 트래픽 변화에 따라서 오토 스케일링 그룹의 용량을 변경
- **대상 추적 조정**: 대상 인스턴스를 추적해서 특정 지표의 목표 값을 유지하기 위해서 오토 스케일링을 적용한다. (EX. CPU 사용률 50% 유지)
- **단계 조정**: 오토 스케일링 그룹의 용량을 단계별로 조정하여 오토 스케일링을 적용한다. 즉, 임곗값 기준으로 임곗값을 넘어서는 크기에 따라서 단계적으로 조정한다.
- **단순 조정**: 오토 스케일링 그룹의 용량을 단일하게 조정한다. 즉, 임곗값을 넘어간다면 넘어간 크기가 얼마든 무관하게 조정한다.

**일정을 기반으로 예약된 조정**

- 작업 시간이나 날짜에 따라서 오토 스케일링 수행

**일정을 기반으로 예측 조정**

- 지난 측정값으로 누적된 기록을 이용해서 트래픽 흐름의 패턴을 예측해서 오토 스케일링 그룹의 인스턴스 수를 늘리거나 줄일 수 있다.

> **🤔: 왜 어떤 것은 수평 스케일링을 사용하고, 어떤 것은 수직 스케일링을 사용할까?**
>- 대상 추적 조정은 **수직 스케일링**이다.
>- 일정을 기반으로 예측 조정은 **수평 스케일링**이다.
>- 잘 생각해 보면 위 두 조정 옵션은 다른 차원의 문제를 해결한다.
>- 대상 추적 조정은 즉각적인 리소스 관리가 우선이다. 이 말은 즉 개별 인스턴스의 성능을 실시간으로 조정하는 데에 적합하다.
>- 예측 조정은 패턴을 기반으로 인스턴스의 개수를 미리 예측 조정한다. 즉, 전체적으로 몇 개의 인스턴스를 운영할지에 대한 결정을 한다.