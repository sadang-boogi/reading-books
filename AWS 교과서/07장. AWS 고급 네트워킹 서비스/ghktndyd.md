### DNS

- Domain Name System

**도메인 주소를 이용한 통신 과정**

1. 웹 서버의 IP 주소를 도메인 주소로 사용하고자 도메인을 구입 (예시에는 ongja.com) 이렇게 구입하면 DNS 서버가 구매한 도메인의 IP 주소가 무엇인지를 저장해둠
2. 사용자는 도메인 주소의 IP 확인을 위해서 DNS 서버에 ongja.com의 도메인 주소를 요청하고 응답 받음. 이때 UDP 53번 포트를 사용하는 DNS 프로토콜으로 통신 (이 과정에서 사용자가
   ongja.com의 IP가 무엇인지 알게 됨)
3. 사용자는 ongja.com의 IP 주소를 알아냈기에 해당 IP 주소로 통신

**도메인 구조**

- 도메인은 영역별로 분류할 수 있다.

> `blog.cloudneta.net.`
> blog = 서브 도메인
> cloudneta = 세컨드 레벨 도메인
> net = 탑 레벨 도메인
> 마지막 온점 = 루트 도메인

탑 레벨 도메인은 TLD라고도 하며 com, net, org 등 다양함

세컨드 레벨 도메인은 상위 TLD에서 유일하게 존재하고 식별하는 도메인 영역

서브 도메인은 도메인 용도에 따라서 명칭을 주어 분류한 도메인

**DNS 서버 종류**

🤔: 왜 도메인을 루트, 탑, 세컨트 레벨, 서브로 굳이 나누어 구분할까?

🧑‍🏫: 영역별로 도메인을 관리하는 주체를 분리하기 위해서

**루트 네임 서버**

1. 루트 도메인 관리
2. TLD에 해당하는 네임 서버 정보 응답
3. 전 세계에 13개

**TLD 네임 서버**

1. TLD 관리
2. TLD 영역에서 식별되는 SLD를 관리하여 SLD 네임 서버 정보 응답
3. 만약 google.com 을 요청한다면 .com에서 google.com을 찾아서 해당 SLD 네임 서버 주소를 응답해줌

**SLD 네임 서버**

1. 실질적 도메인 이름 관리
2. 실제 도메인의 최종 관리 서버로 권한이 있는 네임 서버라고 함
3. 도메인 주소에 대한 IP 주소를 확인하는 마지막 단계

**DNS 해석기**

1. 사용자와 네임 서버들 사이에서 중계자 역할
2. 사용자는 DNS 해석기로 요청을 하게 되는 거고, DNS 해석기가 대신 네임 서버들과 소통하여 도메인 주소를 해석하여 IP 주소를 사용자에게 응답

### DNS 통신 흐름

1. 사용자 PC에서 `blog.cloudneta.net` 이라는 도메인 주소의 IP 주소를 알기 위해 DNS 서버에 질의 (DNS 서버 내에 DNS 해석기가 존재)
2. DNS 해석기는 13개의 루트 네임 서버 주소를 모두 알고 있는데 해당 루트 네임 서버에 `blog.cloudneta.net` 도메인 주소의 IP를 물어봄 (여기서 루트 네임은 .net만 알기 때문에 "나는
   .net의 주소만 알아" 이러면서 .net의 정보만 전달)
3. 그러면 다시 DNS 해석기가 .net에 해당하는 TLD 네임 서버에 `blog.cloudneta.net` 도메인 주소의 IP를 물어봄 (여기서 TLD 네임 서버는 `cloudneta.net`의 SLD 서버만
   알기 때문에 이 주소만 전달)
4. 다시 DNS 해석기가 cloudneta.net에 해당하는 SLD 네임 서버에 `blog.cloudneta.net` 도메인 주소 IP를 물어봄 (이 SLD 네임 서버는 도메인 주소의 최종 정보를 가진 '권한이
   있는 네임 서버' 이므로 도메인에 대한 IP 주소를 DNS 해석기에 전달)
5. DNS 해석기는 전달받은 IP 주소를 PC에 전달하여 사용자 PC는 이것으로 통신

#### DNS 레코드 유형

**A 레코드**

- **IPv4** 주소로 매핑하는 가장 기본적인 DNS 레코드 유형

> `blog.cloudneta.net A 52.219.60.13`

- 이게 즉 blog.cloudneta.net으로 질의하면 IPv4 주소인 52.219.60.13으로 응답

**AAAA 레코드**

- **IPv6** 주소로 매핑하는 DNS 레코드 유형

> `blog.cloudneta.net AAAA 2001:A10::2001

- blog.cloudneta.net으로 질의하면 IPv6 주소인 2001:A10::2001로 응답

**NS 레코드**

- 도메인 이름의 네임 서버 주소로 매핑하는 DNS 레코드 유형

> `net NS a.gtld-servers.net.`

- blog.cloudneta.net으로 질의하면 .net의 TLD 네임 서버 주소인 a.gtld-servers.net.이라는 도메인 주소로 응답

**CNAME 레코드**

- 도메인 이름의 별칭을 지정하는 DNS 레코드 유형

> `www.cloudneta.net CNAME cloudneta.net`

- `www.cloudneta.net`으로 질의하면 cloudneta.net 도메인 주소 응답

### Amazon Route 53

- DNS 프로토콜은 UDP 53번 포트를 사용한다. 그래서 Route 53이다!

#### Route 53 기능

**1. 도메인 이름 등록**

- 도메인 등록은 등록대행소에서 해야 한다.
- 즉 사용자가 도메인 등록 요청시 등록대행소가 대행해줌

**2. 호스팅 영역 생성**

- 호스팅 영역 생성해서 네임 서버 관리
- 호스팅 영역을 생성해야 라우트53이 권한있는 네임 서버이자 SLD 네임 서버 역할을 수행 가능

**3. 레코드 작성**

- DNS 레코드를 정의하여 도메인 요청 처리 방법을 정의

#### Route 53의 라우팅 정책

- **라우팅 정책:** DNS 요청에 어떻게 응답할지를 정의하는 것

**단순 라우팅 정책**

- 도메인에 대해 특정 대상을 지정하는 방식
- 예를 들면 `naver.com`이라는 도메인의 A 레코드가 `10.1.1.1`, `10.1.1.2`가 있다면 단순 라우팅 정책으로 구성시 둘 중 하나가 랜덤으로 응답

**가중치 기반 라우팅 정책**

- 대상의 가중치를 지정하여 비중에 따라서 대상을 선택하고 응답
- 가중치는 0~255 범위에서 설정하는데 대상별 가중치 값을 합산한 전체 가중치를 대상별 가중치로 나누어 비중을 부여
- 예를 들면 `naver.com`이라는 도메인의 A 레코드가 `10.1.1.1`, `10.1.1.2`이다. 그리고 `10.1.1.1`의 가중치를 90으로 두고, `10.1.1.2`의 가중치를 10으로 두면 DNS
  요청에 응답하는 비중이 9:1로 나눠짐

**지연 시간 기반 라우팅 정책**

- 사용자와 인접한 리전을 기준으로 지연시간이 낮은 대상을 선택하고 응답
- 서울 리전과 런던 리전에 자원이 존재하고, 내 위치가 서울이라면 지연시간이 더 낮은 서울 리전으로 요청
  \
  **장애 조치 라우팅 정책**
- 대상 상태를 주기적으로 체크해서 액티브 대상을 선택하고 응답
- 만약 액티브 자원이 장애 발생시 패시브 자원을 액티브 자원으로 승격시켜서 라우팅

### CDN

- Contents Delivery Network
- 컨텐츠 제공자와 사용자가 지리적으로 멀리 떨어져 있는 환경에서 컨텐츠를 빠르게 전달하는 네트워크 기술

> 오리진 서버가 런던이고, 컨텐츠를 요청한 곳이 서울이다.

**CDN이 없다면?**

- 서울에서 런던으로 요청을 해야 하고, 당연스럽게도 지연시간이 길어진다.

**CDN이 있다면?**

- CDN은 캐시 서버를 지역적으로 분산하고, 컨텐츠를 동기화해서 분산 처리한다.
- 즉 오리진 서버가 런던이더라도 캐시 서버가 서울에 있다면 오리진 서버에 요청하는 게 아닌 서울 서버에 요청을 한다.

**CDN 캐싱 방식**

- **캐싱:** 오리진 서버의 원본 컨텐츠를 캐시 서버로 전달하고 컨텐츠를 저장하는 것
- **캐시 미스:** 캐시 서버에 컨텐츠가 존재 X
- **캐시 히트**: 캐시 서버에 컨텐츠가 존재 O
- **TTL**: Time To Live, 컨텐츠를 캐싱하는 시간
- 즉, 캐시 미스라면 캐시 서버가 오리진 서버에 컨텐츠를 요청하고 오리진 서버는 컨텐츠를 복제하여 전달해준다. 그리고 이 컨텐츠를 캐싱하고 유저에게 응답한다.
- 캐시 히트라면 캐시 서버가 오리진 서버에 요청하고 전달받는 과정이 없다.
- **정적 캐싱**: 이미지, 자바스크립트, CSS 등의 컨텐츠, 정적 컨텐츠들은 요청이 없어도 오리진 서버가 캐시 서버로 미리 복제해둔다. 덕분에 TTL 동안 바로 응답 가능한 캐시 히트로 동작
- **동적 캐싱**: 사용자 요청이나 정보에 따라 즉석으로 생성되는 컨텐츠, 동적이니까 캐시 서버에서 컨텐츠를 보관하지 않음. 때문에 캐시 미스

### Amazon CloudFront

- AWS의 CDN 서비스

**구성 요소**

1. **오리진:** 원본 컨텐츠를 갖고 있음. 일반적으로 EC2, ELB 등등
2. **Distribution**: 오리진과 엣지 중간에서 컨텐츠를 배포하는 역할을 수행하는 클라우드프론트의 단위
3. **리전 엣지 캐시**: 빈번하게 사용되는 컨텐츠에 대해서 캐싱하는 큰 단위의 엣지 영역, 오리진과 엣지 로케이션 사이에 위
4. **엣지 로케이션**: Distribution으로 배포되는 컨텐츠를 캐싱하는 작은 단위의 엣지 영역