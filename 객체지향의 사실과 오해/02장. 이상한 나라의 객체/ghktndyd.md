# 02. 이상한 나라의 객체

## 객체지향과 인지 능력

- 객체란 인간이 인지하고, 구별할 수 있는 물리적이거나 개념적인 경계를 지닌 어떤 것이다.
- 객체지향 패러다임의 목적은 현실 세계를 모방하는 것이 아니라 현실 세계를 기반으로 새로운 세계를 창조하는 것이다.

### 객체, 그리고 이상한 나라

#### 이상한 나라의 앨리스

    이상한 나라의 앨리스 줄거리···

#### 앨리스 객체

- 앨리스는 **상태**를 가지고 있으며, 변경될 수 있다.
    - (예시: 작은 문을 통과하기 위해 자신을 키가 작은 상태로 변경)
- 앨리스의 상태를 변화시키는 것은 **행동**이다.
    - (예시: 키가 작아지기 위해서 토끼의 부채로 부채질을 하는 행동)
- 상태를 결정하는 것은 행동이지만 행동의 결과를 결정하는 것은 상태다.
- 행동의 결과는 상태에 의존적이다.
- 어떤 행동의 성공 여부는 이전에 어떤 행동들이 발생했는지에 영향을 받는다.
    - (예시 : 앨리스가 작은 문을 통과하려는 행동이 성공하려면 몸을 작게 줄여야 한다. 따라서 앨리스는 먼저 몸을 줄이기 위해서 병 안의 음료수나 케이크를 먹어야 한다.)
    - 이것은 **행동 간의 순서가 중요하다는 것을 의미**한다.
- 앨리스는 상태와 무관하게 유일한 존재로 **식별 가능**하다.

### 객체, 그리고 소프트웨어 나라

- 객체의 다양한 특성을 효과적으로 설명하기 위해서는 객체를 **상태, 행동, 식별자**를 지닌 실체로 보는 것이 가장 효과적이다.

##### 객체란?

> 식별 가능한 개체 또는 사물이다. 객체는 자동차처럼 만질 수 있는 구체적인 사물일 수도 있고, 시간처럼 추상적인 개념일 수도 있다. 객체는 구별 가능한 식별자, 특징적인 행동, 변경 가능한 상태를 가진다.
> 소프트웨어 안에서 객체는 저장된 상태와 실행 가능한 코드를 통해 구현된다.

#### 상태

##### 상태는 왜 필요한가?

- 객체가 주변과의 상호작용에서 어떻게 반응하는가는 그 시점까지 객체에 어떤 일이 발생했느냐가 좌우한다.
- 어떤 행동의 결과는 과거 어떤 행동들이 일어났었느냐에 의존한다.
- 상태를 이용하면 과거 객체가 어떤 행동들을 했는지는 기억하지 않아도 된다. 현재를 기반으로 객체의 행동 방식을 이해할 수 있다.
- 상태는 근본적으로 세상의 복잡성을 완화하고 인지 과부하를 줄일 수 있는 중요한 개념이다.

##### 상태와 프로퍼티

- 지금까지는 모든 인지할 수 있는 것들이 객체일 것 같았지만 모든 것들이 객체는 아니다.
- 예를 들어서 앨리스의 '키'나 토끼의 '속도'는 객체가 아니다.
- 숫자, 문자열, 양, 속도, 시간, 날짜, 참이나 거짓과 같은 단순한 값들은 객체가 아니다.
- 위와 같은 값들은 다른 객체의 특성을 표현하기 위해서 사용된다.

##### 객체와 객체의 연결

- 때로는 단순한 값이 아니라 객체를 사용해서 다른 객체의 상태를 표현해야 할 경우도 있다.
- 예를 들어서 앨리스가 현재 음료를 들고 있는 상태를 어떻게 표현할까?
- 간단하게는 앨리스의 상태를 음료를 들고 있는지 여부를 표현하면 된다. 이때 앨리스 객체와 음료 객체가 연결된다.

##### 프로퍼티

- 결론적으로 모든 객체의 상태는 단순한 값과 다른 객체와의 조합으로 표현할 수 있다.
- 이때 객체의 상태를 구성하는 모든 특징을 **프로퍼티**라고 한다. (앨리스의 키, 위치, 음료)
- 일반적으로 프로퍼티는 변경되지 않고 고정되기 때문에 **정적**이다.
- 반면 **프로퍼티 값**은 시간이 흐름에 따라 변경이 될 수 있기 때문에 **동적**이다. (앨리스의 키는 작아진다.)

##### 링크

- 객체와 객체 사이의 의미 있는 연결을 **링크**라고 한다. (앨리스와 음료)
- 객체와 객체 사이에는 **링크가 존재해야만 요청을 보내고 받을 수 있다.**
- 객체의 **링크를 통해서만 메세지를 주고 받을 수 있다.**
- 링크는 객체가 다른 객체를 참조할 수 있다는 것을 의미하고, 한 객체가 다른 객체의 식별자를 알고 있다는 것으로 표현된다.

##### 속성

- 객체를 구성하는 단순한 값은 **속성**이다. (앨리스의 키와 음료)

즉, 객체의 **프로퍼티**는 단순한 값인 **속성**과 다른 객체와의 연결인 **링크**로 구성되어 있다.

##### 객체의 상태란?

> **상태**는 특정 시점에 객체가 갖고 있는 정보의 집합으로 객체의 구조적 특징을 표현한다. **객체의 상태는 프로퍼티와 프로퍼티 값으로 구성**된다. **객체의 프로퍼티는 단순한 값과 다른 객체를 참조하는
링크로 구분**된다.

##### 객체는 자율적

- 객체지향 세계에서는 객체는 다른 객체의 상태에 직접적인 접근이 불가능하고, 상태를 변경할 수도 없다.
- 자율적인 객체를 스스로 자신의 상태를 책임져야 한다.
- 하지만 외부의 객체가 다른 객체의 상태를 변경하거나 조회할 수 있는 방법도 필요하다.
- 이때 **행동**이라는 개념이 등장한다.
- **행동**은 다른 객체가 간접적으로 객체의 상태를 변경할 수 있게 해준다.
- 객체지향의 기본 사상은 상태와 상태를 조작하는 행동을 하나의 단위로 묶는다는 것을 기억하라.

#### 행동

##### 상태와 행동

- 객체가 하는 행동은 객체 자신의 상태를 변경시킨다.
- 객체의 행동에 의해 객체의 상태가 변경된다는 것은 **부수 효과(side effect)** 를 초래한다.
- (예시 : 앨리스가 케이크를 먹는 행동은 케이크의 양을 줄게 하는 부수 효과를 초래한다.)
- 객체의 행동은 상태에 영향을 받고, 상태를 변경시킨다.

##### 협력과 행동

- 객체가 다른 객체와 협력하는 유일한 방법은 **다른 객체에게 요청**을 보내는 것이다.
- 이때 **수신자 객체**는 요청을 처리하기 위해 적절한 **행동을 취한다**.
- 객체의 행동은 객체가 협력에 참여할 수 있는 유일한 방법이다.
- 객체는 협력의 과정에서 자신의 상태 뿐만 아니라 다른 객체의 상태 변경을 유발할 수 있다.
- (예시 : 제가 음료를 마셨으니까 음료의 양을 줄여주세요.)

##### 행동이란?

> 외부의 요청 또는 수신된 메세지에 응답하기 위한 활동이다. 행동의 결과로 객체는 자신의 상태를 변경하거나 다른 객체에게 메세지를 전달할 수 있다. 객체는 행동을 통해 다른 객체와의 협력에 참여하므로 행동은 외부에
> 가시적이어야 한다.

#### 상태 캡슐화

- 현실 세계와 객체 != 객체지향 세계의 객체
- 차이점은 객체 스스로가 자신의 상태를 책임질 수 있는지 없는지다.
- **객체지향 세계의 모든 객체**는 **자신의 상태를 스스로 변경할 수 있는 자율적인 존재**다.
- 예를 들어서 앨리스가 음료를 마시면 앨리스는 음료를 마신 것 뿐이지. 앨리스가 음료의 양(상태)를 변경할 수 없다.
- 앨리스는 그저 음료에게 **음료 마셨으니 양을 줄여줘** 라는 메세지만 보낸다.
- 이때 중요한 건 앨리스는 음료의 상태 변경에 대해서는 전혀 알지 못한다.
- 이것이 **캡슐화의 의미**이다.
- 객체가 외부에 노출하는 것은 행동 뿐이다.
- 외부에서 객체에 접근할 수 있는 것도 행동 뿐이다.
- 객체의 행동을 유발하는 것은 외부로부터 전달된 메세지지만 객체의 상태를 변경할지 여부는 수신자 객체 스스로 결정한다.

##### 무슨 의미가 있는가?

- 상태를 외부에 노출시키지 않는 행동인 캡슐화는 객체의 자율성을 높인다. (자신의 상태는 오롯이 자신만 자유롭게 변경하기 때문에)
- 결론적으로 상태를 행동 뒤로 캡슐화하는 것은 객체의 자율성을 높이고 협력을 단순하고 유연하게 만든다.

> 이 단락은 유독 비슷한 문장이 많이 나온 것 같습니다. 또 저는 왜 캡슐화가 자율성을 높이는지가 이해가 되지 않습니다. 캡슐화의 장점을 모르겠다는 것이 아니라 캡슐화 때문에 자율성이 높아진다는 것을 모르겠습니다.
> 🥲
> 제가 생각했을 때는 자율성이 높은 것은 개발자가 필드에 접근하는 게 안 좋더라도 자율성만 놓고 봤을 때는 더 자율적이지 않나? 하는 생각이 들기 때문입니다.

#### 식별자

- 객체가 식별이 가능하다는 것은 **객체를 서로 구별할 수 있는 특정한 프로퍼티가 존재한다는 것을 의미**한다.
- 이 프로퍼티를 ***식별자*** 라고 부른다. (구별 가능한 특정한 프로퍼티)
- 객체가 아닌 단순한 값은 식별자가 없다.
- **상태**를 이야기할 때 객체의 프로퍼티 타입은 다른 객체 혹은 단순한 값이라고 했다.
- **값과 객체의 가장 큰 차이는 식별자 존재 여부다.**

##### 값

- 숫자, 문자열, 날짜, 시간, 금액 등 변하지 않는 양을 모델링한다.
- 흔히 값의 상태는 잘 변하지 않기에 **불변 상태(immutable state)** 를 가진다고 한다.
- 값은 두 인스턴스의 상태가 같다면 같은 것으로 판단한다.
- 값이 같은지 여부는 상태가 같은지로 판단한다. (1, 1은 같다.)
- 값의 상태가 같으면 두 인스턴스는 동일한 것으로 판단하고 상태가 다르면 두 인스턴스는 다른 것으로 판단한다.
- 이처럼 **상태를 이용해 두 값이 같은지 판단하는 성질**을 ***동등성(equality)*** 이라고 한다.
- 상태를 이용해서 동등성을 판단할 수 없는 이유는 값의 상태는 변하지 않는다. (1은 1이다. 1은 다른 값으로 변하지 않는다.)
- **그렇기에 식별자가 필요하지 않다.**

##### 객체

- 객체는 시간에 따라 변경되는 상태를 포함한다.
- 행동을 통해서 상태를 변경한다.
- 객체는 **가변상태(mutable state)** 를 가진다고 한다.
- 타입이 같은 두 객체의 상태가 완전히 똑같아도 두 객체는 다르다.
- (이름이 김수용이고, 키도 180인 나랑 똑같은 김수용이 있어도 나 김수용과는 다르다.)
- 대신 객체는 상태와 무관하게 판단될 수 있는 일종의 식별자를 가지고 있다.
- (어릴 때의 김수용과 성인의 김수용은 상태가 매우 다르다.. 하지만 같은 객체라고 생각한다.)
- 이처럼 **식별자를 기반으로 객체가 같은지를 판단하는 성질**을 **동일성(identical)** 이라고 한다.
- 객체는 시간이 흐름에 따라서 상태가 변하기 때문에 상태로 동일성을 판단할 수 없다.
- 그렇기에 객체가 동일한지 판단하려면 식별자가 필요한 것이다.

##### 식별자

> 어떤 객체를 다른 객체와 구분하는 데에 사용하는 객체의 프로퍼티다. **값은 식별자를 가지지 않기에 동등성 검사**를 통해서 같은지 비교해야 하고, **객체는 상태가 변경될 수 있기 때문에 식별자를 이용한 동일성
검사**를 이용해서 두 인스턴스를 비교해야 한다.

##### 값과 객체가 헷갈리는 이유

- 값과 객체가 헷갈릴 수 있다. (저도 그랬습니다..)
- 이유는 객체지향 프로그래밍 언어에서는 두 개념 모두 **class**로 구현되고 있기 때문이다.
- 객체지향 프로그래밍 언어에서 숫자는 **Integer** 클래스로, 사람은 **Person** 클래스로부터 생성된 객체다.
- 모두 클래스로부터 생성되어서 문맥상 의미가 혼란스러울 수 있다.

##### 오해의 소지를 줄이자

- 이와 같은 오해를 줄이기 위해서 객체와 값을 지칭하는 별도의 용어가 있다.
- **참조 객체(reference object)**, 또는 **엔티티(entity)** 는 식별자를 지닌 전통적인 객체를 가르킨다.
- **값 객체(value object)** 는 식별자를 가지지 않는 값을 가리키는 용어다.

##### 객체의 중요한 특성(상태, 행동, 식별자)

- 객체는 상태를 가지며 상태는 변경 가능하다.
- 객체의 상태를 변경시키는 것은 객체의 행동이다.
    - 행동의 결과는 상태에 의존적이며 상태를 이용해서 서술할 수 있다.
    - 행동의 순서가 실행 결과에 영향을 미친다.
- 객체는 어떤 상태더라도 식별자가 있기에 식별 가능하다.

### 기계로서의 객체

- 객체지향 개발자의 주된 업무는 객체의 상태를 조회하거나 변경하는 것이다.
- 이때 조회하는 작업을 **쿼리(query)** 라고 한다.
- 변경하는 작업을 **명령(command)** 라고 한다.

### 행동이 상태를 결정한다

- 초보자들은 먼저 객체에 필요한 상태가 무엇인지를 결정하고, 그 상태에 필요한 행동을 결정한다.
- 예를 들어서 앨리스 객체에게 키와 위치라는 상태가 필요할 것 같으니 이를 먼저 추가하고, 키와 위치를 관리하는 행동을 고민한다.
- 하지만 위와 같은 방법은 좋은 설계에 나쁜 영향을 끼친다.

##### 상태를 먼저 결정하는 게 나쁜 영향을 끼치는 이유

1. **캡슐화가 저해된다.**

- 상태에 초점을 맞출 경우 상태가 객체 내부로 캡슐화되지 않고, 공용 인터페이스에 노출될 확률이 높아진다.

2. **객체를 고립된 섬으로 만든다.**

- 객체는 다른 객체와 협력해야 한다.
- 상태를 먼저 고려한다면 협력에 적합하지 못한 객체가 만들어질 가능성이 높다.

3. **객체의 재사용성이 저하된다.**

- 객체의 재사용성은 다양한 협력에 참여할 수 있는 능력이다.
- 상태에 초점을 맞춘 객체는 다양한 협력에는 참여하기 어렵다.

##### 행동에 초점을 맞추고 객체를 만들자.

- **협력에 참여하는 객체의 가장 중요한 덕목은 행동이다.**
- 객체는 앞서 말했듯 다른 객체와의 협력을 위해 존재한다.
- 객체의 행동이 협력에 참여하는 유일한 방법이기 때문에 **객체가 적합한지를 결정하는 것은 상태가 아니라 행동이다.**
- 객체지향 설계는 애플리케이션에서 필요한 협력을 먼저 생각하고,
- 필요한 행동을 생각한 뒤에,
- 행동을 수행할 객체를 선택하는 방식으로 이뤄진다.
- 행동을 먼저 결정하고, 필요한 정보가 무엇인지를 고려하게 되며 이 과정에서 상태가 결정된다.
- 즉, **객체의 행동이란 협력에서 객체 스스로가 완수해야 하는 책임이다.**
- 어떤 책임이 필요한가? 를 결정하는 것이 전체 설계를 주도한다
- 이를 **책임-주도 설계**(***R***esponsibility-***D***riven ***D***esingn) 라고 한다.

### 은유와 객체

#### 두 번째 도시전설

> 객체지향은 현실 세계의 모방이다.

- 안타깝지만 객체지향 세계는 현실 세계의 단순한 모방이 아니다.
- 현실 세계의 객체는 하지 못하는 일을 객체지향 세계의 객체는 할 수 있다.
- 예를 들면, 현실의 음료 객체는 스스로 양을 줄이지 못한다.
- 하지만 객체지향 세계의 음료 객체는 스스로 양을 줄일 수 있다.
- 이것이 객체지향 세계와 현실 세계가 전혀 다르다는 것을 의미한다.

#### 의인화

##### 현실 세계의 객체 vs 객체지향 세계의 객체

- 현실과 객체지향 세계의 가장 큰 차이점이 무엇일까?
- 그것은 현실 세계에서 수동적인 존재가 객체지향 세계에서는 능동적으로 변한다는 것이다.
- 위의 설명을 예를 들자면
- 현실 속의 트럼프 카드는 스스로 뒤집는 능력이 없다. 누군가 뒤집어 주어야 한다.
- 현실 속의 챗셔 고양이는 웃지 못한다.
- 객체지향 속의 트럼프 카드는 스스로 뒤집을 수 있다.
- 객체지향 속의 챗셔 고양이는 웃을 수 있다.
- 이러한 소프트웨어 객체의 특징을 **의인화** 라고 부른다.

##### 은유

- 앞서 말했듯 객체지향 세계와 현실 세계는 전혀 상관이 없는 것일까?
- 그것은 또 아니다.
- 현실 세계와 객체지향 세계의 관계를 좀 더 명확하게 설명할 수 있는 단어는 **은유**다.
- 현실 세계의 전화기는 스스로 전화를 걸 수 없지만 전화기라는 개념을 이용해 객체지향 세계의 객체를 묘사하면 그 객체가 전화를 걸 수 있다는 사실을 쉽게 이해하고 기억할 수 있다.
- 이 때문에 현실 세계의 객체 이름을 객체지향 세계의 객체 이름으로 사용하여서 표현적 차이를 줄이라고 하는 이유다.

#### 이상한 나라를 창조하라

> 객체지향 설계자로서 우리의 목적은 현실의 모방이 아니다.
> 단지 이상한 나라를 창조하기만 하면 된다.
